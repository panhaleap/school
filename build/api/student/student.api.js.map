{"version":3,"sources":["../../../src/api/student/student.api.js"],"names":["condiSearchByName","filterByName","wordSplit","name","split","forEach","word","index","theArray","RegExp","trim","twoWordCondition","$or","$and","firstName","lastName","oneWordCondition","length","getLimit","limit","getSkip","page","skip","createStudent","req","res","age","gender","scoreDetail","body","student","Student","result","save","error","console","log","getStudentList","isActive","query","filterByActive","filterByGender","$in","conditionByName","condition","students","total","Promise","all","find","count","message","options","getStudentById","id","params","findOne","_id","updateStudentById","data","findOneAndUpdate","$set","deleteStudentById"],"mappings":"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","file":"student.api.js","sourcesContent":["import { failed, succeed } from '../../common/response';\r\nimport { Student } from '../../models/student';\r\n\r\nconst condiSearchByName = (filterByName) => {\r\n    let wordSplit = { ...filterByName }.name.split(\" \", 2);\r\n\r\n    wordSplit.forEach((word, index, theArray) => { theArray[index] = new RegExp(`${word.trim()}`, \"i\"); });\r\n\r\n    const twoWordCondition = {\r\n        $or: [\r\n            { $and: [{ firstName: wordSplit[0] }, { lastName: wordSplit[1] }] },\r\n            { $and: [{ firstName: wordSplit[1] }, { lastName: wordSplit[0] }] }\r\n        ]\r\n    };\r\n\r\n    const oneWordCondition = { $or: [{ firstName: wordSplit[0] }, { lastName: wordSplit[0] }] };\r\n    return wordSplit.length < 2 ? oneWordCondition : twoWordCondition;\r\n};\r\n\r\nconst getLimit = (limit) => {\r\n    limit = +limit;\r\n    return (limit > 100) ? 100 : limit;\r\n};\r\n\r\nconst getSkip = (page, limit) => {\r\n    page = +page;\r\n    const skip = limit * (page - 1);\r\n    return skip;\r\n};\r\n\r\nexport const createStudent = async (req, res) => {\r\n    try {\r\n        const { firstName, lastName, age, gender, scoreDetail } = req.body;\r\n        const student = new Student({ firstName, lastName, age, gender, scoreDetail });\r\n        const result = await student.save();\r\n        if (result) succeed(res, result, 200);\r\n        else failed(res, 'Couldn\\'t create student', 500);\r\n    } catch (error) {\r\n        console.log(error);\r\n        failed(res, error, 400);\r\n    }\r\n};\r\n\r\nexport const getStudentList = async (req, res) => {\r\n    try {\r\n        let { limit = 10, page = 1, isActive, gender, name } = req.query;\r\n        console.log(name);\r\n        limit = getLimit(limit);\r\n        const skip = getSkip(page, limit);\r\n\r\n        const filterByActive = isActive ? { isActive } : { isActive: true };\r\n        const filterByGender = gender ? { gender: { $in: gender } } : { gender: { $in: [\"male\", \"female\"] } };\r\n        console.log(filterByGender);\r\n        const filterByName = name ? { name } : {};\r\n        const conditionByName = name ? condiSearchByName(filterByName) : {};\r\n\r\n        const condition = { ...filterByActive, ...filterByGender };\r\n\r\n        const [students, total] = await Promise.all([\r\n            Student.find(conditionByName).find(condition)\r\n                .skip(skip)\r\n                .limit(limit),\r\n            Student.count(conditionByName).count(condition)\r\n        ]);\r\n\r\n        if (students) succeed(res, { message: 'Success', 'Data': students, options: { limit, skip, total } }, 200);\r\n        else failed(res, 'Not Found', 404);\r\n    } catch (error) {\r\n        console.log(error);\r\n        failed(res, error, 400);\r\n    }\r\n};\r\n\r\nexport const getStudentById = async (req, res) => {\r\n    try {\r\n        const { id } = req.params;\r\n        const student = await Student.findOne({ _id: id, isActive: true });\r\n        if (student) succeed(res, { message: 'Success', 'Data': student }, 200);\r\n        else failed(res, 'Not Found', 404);\r\n    } catch (error) {\r\n        console.log(error);\r\n        failed(res, error, 400);\r\n    }\r\n};\r\n\r\nexport const updateStudentById = async (req, res) => {\r\n    try {\r\n        const data = req.body;\r\n        const { id } = req.params;\r\n        const student = await Student.findOneAndUpdate({ _id: id, isActive: true },{ $set: data });\r\n        if(student) succeed(res, {message: 'Updated Sucess', 'Data': student}, 200);\r\n        else failed(res, {message: 'Student not found'}, 404);\r\n    } catch (error) {\r\n        console.log(error);\r\n        failed(res, error, 400);\r\n    }\r\n};\r\n\r\nexport const deleteStudentById = async (req, res) => {\r\n    try {\r\n        const { id } = req.params;\r\n        const student = await Student.findOneAndUpdate({ _id: id, isActive: true },{ $set: {isActive: false} });\r\n        if(student) succeed(res, {message: 'Deleted Sucess'}, 200);\r\n        else failed(res, {message: 'Student not found'}, 404);\r\n    } catch (error) {\r\n        console.log(error);\r\n        failed(res, error, 400);\r\n    }\r\n};"]}