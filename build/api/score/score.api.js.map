{"version":3,"sources":["../../../src/api/score/score.api.js"],"names":["getLimit","limit","getSkip","page","skip","createScore","req","res","student","subject","score","body","console","log","query","status","json","error","getScoretList","isActive","filterByActive","condition","scoreModels","total","Promise","all","Score","find","populate","path","select","count","message","Data","options","getScoreById","id","params","scoreModel","findOne","_id","updateScoreById","data","findOneAndUpdate","$set","deleteScoreById"],"mappings":"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","file":"score.api.js","sourcesContent":["import { failed, succeed } from '../../common/response';\r\nimport { Score } from '../../models/score';\r\n\r\nconst getLimit = limit => {\r\n  limit = +limit;\r\n  return limit > 100 ? 100 : limit;\r\n};\r\n\r\nconst getSkip = (page, limit) => {\r\n  page = +page;\r\n  const skip = limit * (page - 1);\r\n  return skip;\r\n};\r\n\r\n//This one is correct\r\n// export const createScore = async (req, res) => {\r\n//   try {\r\n//     const { student, subject, score } = req.body;\r\n//     const scoreModel = new Score({ student, subject, score });\r\n//     const result = await scoreModel.save();\r\n//     if (result) succeed(res, { message: 'Created Success', Data: result }, 200);\r\n//     else failed(res, \"Couldn't create subject\", 500);\r\n//   } catch (error) {\r\n//     console.log(error);\r\n//     failed(res, error, 400);\r\n//   }\r\n// };\r\n\r\nexport const createScore = async (req, res) => {\r\n  try {\r\n    const { student, subject, score } = req.body;\r\n    console.log(req.query.score);\r\n    return res.status(200).json(score);\r\n  } catch (error) {\r\n    console.log(error);\r\n    failed(res, error, 400);\r\n  }\r\n};\r\n\r\nexport const getScoretList = async (req, res) => {\r\n  try {\r\n    let { limit = 10, page = 1, isActive } = req.query;\r\n    limit = getLimit(limit);\r\n    const skip = getSkip(page, limit);\r\n\r\n    const filterByActive = isActive ? { isActive } : { isActive: true };\r\n    const condition = { ...filterByActive };\r\n\r\n    const [scoreModels, total] = await Promise.all([\r\n      Score.find(condition)\r\n        .populate({ path: 'student', select: '-_id firstName lastName' })\r\n        .populate({path: 'subject', select: '-_id name'})\r\n        .skip(skip)\r\n        .limit(limit),\r\n      Score.count(condition)\r\n    ]);\r\n\r\n    if (scoreModels) succeed(res, { message: 'Success', Data: scoreModels, options: { limit, skip, total } }, 200);\r\n    else failed(res, 'Not Found', 404);\r\n  } catch (error) {\r\n    console.log(error);\r\n    failed(res, error, 400);\r\n  }\r\n};\r\n\r\nexport const getScoreById = async (req, res) => {\r\n  try {\r\n    const { id } = req.params;\r\n    const scoreModel = await Score.findOne({ _id: id, isActive: true }).populate({ path: 'student', select: '-_id firstName lastName' })\r\n    .populate({path: 'subject', select: '-_id name'});\r\n    if (scoreModel) succeed(res, { message: 'Success', Data: scoreModel }, 200);\r\n    else failed(res, 'Not Found', 404);\r\n  } catch (error) {\r\n    console.log(error);\r\n    failed(res, error, 400);\r\n  }\r\n};\r\n\r\nexport const updateScoreById = async (req, res) => {\r\n  try {\r\n    const data = req.body;\r\n    const { id } = req.params;\r\n    const scoreModel = await Score.findOneAndUpdate({ _id: id, isActive: true }, { $set: data });\r\n    if (scoreModel) succeed(res, { message: 'Updated Sucess', Data: scoreModel }, 200);\r\n    else failed(res, { message: 'Score not found' }, 404);\r\n  } catch (error) {\r\n    console.log(error);\r\n    failed(res, error, 400);\r\n  }\r\n};\r\n\r\nexport const deleteScoreById = async (req, res) => {\r\n  try {\r\n    const { id } = req.params;\r\n    const scoreModel = await Score.findOneAndUpdate({ _id: id, isActive: true }, { $set: { isActive: false } });\r\n    if (scoreModel) succeed(res, { message: 'Deleted Sucess' }, 200);\r\n    else failed(res, { message: 'Student not found' }, 404);\r\n  } catch (error) {\r\n    console.log(error);\r\n    failed(res, error, 400);\r\n  }\r\n};\r\n"]}